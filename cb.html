<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
! MPL 2.0 HEADER START
!
! This Source Code Form is subject to the terms of the Mozilla Public
! License, v. 2.0. If a copy of the MPL was not distributed with this
! file, You can obtain one at http://mozilla.org/MPL/2.0/.
!
! If applicable, add the following below this MPL 2.0 HEADER, replacing
! the fields enclosed by brackets "[]" replaced with your own identifying
! information:
!     Portions Copyright [yyyy] [name of copyright owner]
!
! MPL 2.0 HEADER END
!
!     Copyright 2013 ForgeRock AS
!
-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>OpenID Connect Basic Client Profile</title>
    <script type="text/javascript"
            src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="basic.js"></script>
    <script type="text/javascript">

        $(document).ready(function () {
            var params = getParamsFromFragment();
            if (params != undefined) {
                $("#code").html("<h3>Response From Provider</h3>"
                        + "<pre>"
                        + JSON.stringify(params, undefined, 2)
                        + "</pre>"
                );
            } else {
                $("#info").html("<p>Error obtaining response.</p>");
                return;
            }

            $("#disclaimer").html(
                    "Note: No validation done in this simple example.");


            var idToken = params["id_token"];
            idToken = idToken.split(/\./);
            idToken = atob(idToken[1]);
            $("#token").html("<h3>Decoded ID Token</h3>"
                    + "<pre>"
                    + JSON.stringify(JSON.parse(idToken), undefined, 2)
                    + "</pre>"
            );


            $.ajax({
                url: server + openam + info,
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Authorization",
                            "Bearer " + params["access_token"]);
                },
                data: {
                    "scope": "openid profile"
                }
            }).done(function (data) {
                        $("#info").html(
                                "<h3>Token Info</h3>"
                                        + "<pre>"
                                        + JSON.stringify(data, undefined, 2)
                                        + "</pre>"
                        );
                    }).fail(function (data) {
                        $("#info").html(
                                "<p>Error obtaining token info:</p>"
                                        + "<pre>"
                                        + JSON.stringify(data, undefined, 2)
                                        + "</pre>"
                        );
                    });
        });
    </script>
</head>
<body>

<div id="disclaimer"></div>

<div id="code"><!-- code goes here --></div>

<div id="token"><!-- token goes here --></div>

<div id="info"><!-- info goes here --></div>

<div><hr>Back to the <a href="index.html">start page</a></div>
</body>
</html>